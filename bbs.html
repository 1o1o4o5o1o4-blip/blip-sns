<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pairly | Connect with Everything</title>
    <script src="https://cdn.jsdelivr.net"></script>
    <style>
        :root { --p-v: #6366f1; --bg: #dae0e6; --card: #ffffff; --text: #1c1c1c; --meta: #787c7e; --border: #ccc; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 0; color: var(--text); }
        header { background: var(--card); padding: 10px 40px; display: flex; align-items: center; position: sticky; top: 0; z-index: 10; border-bottom: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .logo { font-size: 24px; font-weight: 900; color: var(--p-v); text-decoration: none; font-style: italic; letter-spacing: -1px; }
        .container { max-width: 640px; margin: 20px auto; padding: 0 10px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 4px; padding: 15px; margin-bottom: 15px; text-align: center; }
        .btn { display: block; padding: 12px; background: var(--p-v); color: white; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; text-decoration: none; }
        .post { background: var(--card); border: 1px solid var(--border); border-radius: 4px; display: flex; margin-bottom: 10px; cursor: pointer; text-align: left; }
        .votes { background: rgba(0,0,0,0.02); width: 40px; padding: 10px 0; text-align: center; font-weight: bold; }
        .content { padding: 12px; flex: 1; min-width: 0; }
        .title { font-size: 18px; font-weight: 600; margin: 5px 0; line-height: 1.2; }
        .meta { font-size: 12px; color: var(--meta); margin-bottom: 8px; }
        .body-preview { font-size: 14px; color: #333; line-height: 1.5; overflow: hidden; }
        .body-preview img { max-width: 100%; border-radius: 4px; }
    </style>
</head>
<body>

<header>
    <a href="#" class="logo" onclick="location.reload()">Pairly</a>
</header>

<div class="container">
    <div class="card">
        <h3 style="margin:0 0 10px 0; font-size:16px;">Pairly ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</h3>
        <!-- ã‚ãªãŸã®ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªåã«è‡ªå‹•å¯¾å¿œã™ã‚‹ãƒœã‚¿ãƒ³ -->
        <a id="post-btn" href="#" target="_blank" class="btn">ğŸš€ æ–°ã—ãæŠ•ç¨¿ãƒ»å†™çœŸã‚’è²¼ã‚‹</a>
    </div>
    <div id="feed"><p style="text-align:center;">èª­ã¿è¾¼ã¿ä¸­...</p></div>
</div>

<script>
    // âš ï¸ ã‚ãªãŸã®ç¾åœ¨ã®ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã‚’è‡ªå‹•å–å¾—ã—ã¦URLã‚’ä¿®æ­£ã™ã‚‹
    const pathArray = window.location.pathname.split('/');
    const repoName = pathArray[1] || "blip-sns"; // ãƒªãƒã‚¸ãƒˆãƒªåãŒå–ã‚Œãªã„æ™‚ã®äºˆå‚™
    const userName = "1o1o4o5o1o4-blip";
    const fullRepo = `${userName}/${repoName}`;

    // æŠ•ç¨¿ãƒœã‚¿ãƒ³ã®ãƒªãƒ³ã‚¯ã‚’æ­£ã—ãè¨­å®š
    document.getElementById('post-btn').href = `https://github.com{fullRepo}/issues/new`;

    async function loadFeed() {
        try {
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ç ´å£Šã—ã¦å¼·åˆ¶çš„ã«æœ€æ–°ã®Issuesã‚’å–ã£ã¦ãã‚‹
            const res = await fetch(`https://api.github.com{fullRepo}/issues?state=all&sort=created&_=${new Date().getTime()}`);
            if (!res.ok) throw new Error();
            const data = await res.json();
            
            const feed = document.getElementById('feed');
            if (data.length === 0) {
                feed.innerHTML = "<p style='text-align:center;'>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¸Šã®ãƒœã‚¿ãƒ³ã‹ã‚‰æŠ•ç¨¿ã—ã¦ã¿ã¦ã­ï¼</p>";
                return;
            }

            feed.innerHTML = data.map(item => `
                <div class="post" onclick="window.open('${item.html_url}', '_blank')">
                    <div class="votes">â–²<br>${item.comments}</div>
                    <div class="content">
                        <div class="meta">u/${item.user.login} â€¢ ${new Date(item.created_at).toLocaleDateString()}</div>
                        <h2 class="title">${item.title}</h2>
                        <div class="body-preview">${marked.parse(item.body || '')}</div>
                    </div>
                </div>
            `).join('');
        } catch (e) {
            document.getElementById('feed').innerHTML = "âš ï¸ èª­ã¿è¾¼ã¿åˆ¶é™ä¸­ã§ã™ã€‚1åˆ†å¾Œã«ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚";
        }
    }
    loadFeed();
</script>
</body>
</html>
